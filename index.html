<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>THE JOURNEY</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root { --bg-color: #000000; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--bg-color);
            height: 100vh;
            overflow: hidden;
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* --- IMMERSIVE PORTAL LOADER --- */
        #loadingScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 10000;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }

        #portalCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }

        /* --- VIDEO STAGE --- */
        .stage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        video { width: 100%; height: 100%; object-fit: cover; opacity: 0; display: block; }

        .flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 10001; opacity: 0; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="loadingScreen">
        <canvas id="portalCanvas"></canvas>
    </div>

    <div class="flash" id="flash"></div>

    <div class="stage">
        <video id="video" muted playsinline preload="auto">
            <source src="journey.mp4" type="video/mp4">
        </video>
    </div>

    <script>
        gsap.registerPlugin(ScrollTrigger);
        const canvas = document.getElementById('portalCanvas');
        const ctx = canvas.getContext('2d');
        const video = document.getElementById('video');
        
        let particles = [];
        let loaded = false;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = (Math.random() - 0.5) * canvas.width;
                this.y = (Math.random() - 0.5) * canvas.height;
                this.z = Math.random() * canvas.width;
                this.o = Math.random();
            }
            update() {
                this.z -= loaded ? 20 : 2; // Beschleunigt massiv, wenn geladen
                if (this.z <= 0) this.reset();
            }
            draw() {
                let x = (this.x / this.z) * canvas.width + canvas.width / 2;
                let y = (this.y / this.z) * canvas.height + canvas.height / 2;
                let r = (1 - this.z / canvas.width) * 3;
                
                ctx.beginPath();
                ctx.fillStyle = `rgba(255, 255, 255, ${1 - this.z / canvas.width})`;
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        for(let i=0; i<300; i++) particles.push(new Particle());

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animate);
        }
        animate();

        // Simulation der Ladezeit & Transition
        window.addEventListener('load', () => {
            setTimeout(() => {
                loaded = true;
                const tl = gsap.timeline({
                    onComplete: () => {
                        document.getElementById('loadingScreen').style.display = "none";
                        document.body.style.overflow = "auto";
                        document.body.style.height = "500vh";
                        initScroll();
                    }
                });

                tl.to("#flash", { opacity: 1, duration: 0.4, ease: "power2.in", delay: 1 });
                tl.set(video, { opacity: 1 });
                tl.to("#flash", { opacity: 0, duration: 1.5 });
            }, 3000);
        });

        function initScroll() {
            if(video.readyState >= 1) video.currentTime = 0.01;
            gsap.to(video, {
                scrollTrigger: { trigger: "body", start: "top top", end: "bottom bottom", scrub: 1 },
                onUpdate: self => { if(video.readyState >= 1) video.currentTime = self.progress * (video.duration - 0.05); }
            });
        }
    </script>
</body>
</html>
